<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Partition By | Full-stack web development notes.</title>
    <meta name="description" content="Full-stack web development notes.">
    
    
    <link rel="preload" href="/notes/assets/css/0.styles.69480afa.css" as="style"><link rel="preload" href="/notes/assets/js/app.b2f0b337.js" as="script"><link rel="preload" href="/notes/assets/js/2.1225d179.js" as="script"><link rel="preload" href="/notes/assets/js/11.c1cf1b66.js" as="script"><link rel="prefetch" href="/notes/assets/js/10.ad79507a.js"><link rel="prefetch" href="/notes/assets/js/12.13036d52.js"><link rel="prefetch" href="/notes/assets/js/13.7938725b.js"><link rel="prefetch" href="/notes/assets/js/14.1de88fe6.js"><link rel="prefetch" href="/notes/assets/js/15.8efffe63.js"><link rel="prefetch" href="/notes/assets/js/16.6e436b02.js"><link rel="prefetch" href="/notes/assets/js/17.19a8b946.js"><link rel="prefetch" href="/notes/assets/js/18.ee0c949d.js"><link rel="prefetch" href="/notes/assets/js/19.4b320e7c.js"><link rel="prefetch" href="/notes/assets/js/20.08ab0b67.js"><link rel="prefetch" href="/notes/assets/js/21.b99757f6.js"><link rel="prefetch" href="/notes/assets/js/22.00f309fb.js"><link rel="prefetch" href="/notes/assets/js/23.ce26102d.js"><link rel="prefetch" href="/notes/assets/js/24.b0410150.js"><link rel="prefetch" href="/notes/assets/js/25.8d753f87.js"><link rel="prefetch" href="/notes/assets/js/26.18e891e6.js"><link rel="prefetch" href="/notes/assets/js/27.7d7999d4.js"><link rel="prefetch" href="/notes/assets/js/28.9774fd5a.js"><link rel="prefetch" href="/notes/assets/js/29.c8a41031.js"><link rel="prefetch" href="/notes/assets/js/3.50d7592f.js"><link rel="prefetch" href="/notes/assets/js/30.97f18ff4.js"><link rel="prefetch" href="/notes/assets/js/31.1a22d7ad.js"><link rel="prefetch" href="/notes/assets/js/32.3111817b.js"><link rel="prefetch" href="/notes/assets/js/33.6efec194.js"><link rel="prefetch" href="/notes/assets/js/34.dda5567c.js"><link rel="prefetch" href="/notes/assets/js/35.40a56c44.js"><link rel="prefetch" href="/notes/assets/js/36.458d1789.js"><link rel="prefetch" href="/notes/assets/js/37.9e76c86f.js"><link rel="prefetch" href="/notes/assets/js/38.ea35f119.js"><link rel="prefetch" href="/notes/assets/js/39.474b3651.js"><link rel="prefetch" href="/notes/assets/js/4.5850f364.js"><link rel="prefetch" href="/notes/assets/js/40.9b2812bd.js"><link rel="prefetch" href="/notes/assets/js/41.b2ed6f89.js"><link rel="prefetch" href="/notes/assets/js/42.bedea5a6.js"><link rel="prefetch" href="/notes/assets/js/43.52d01c0b.js"><link rel="prefetch" href="/notes/assets/js/44.bf6db40e.js"><link rel="prefetch" href="/notes/assets/js/45.a6ddf2fb.js"><link rel="prefetch" href="/notes/assets/js/46.ccf7223f.js"><link rel="prefetch" href="/notes/assets/js/47.6b608624.js"><link rel="prefetch" href="/notes/assets/js/48.02d66f09.js"><link rel="prefetch" href="/notes/assets/js/49.35cdabf7.js"><link rel="prefetch" href="/notes/assets/js/5.4fdd094a.js"><link rel="prefetch" href="/notes/assets/js/50.8e046486.js"><link rel="prefetch" href="/notes/assets/js/51.c23cdab9.js"><link rel="prefetch" href="/notes/assets/js/52.a0c473fb.js"><link rel="prefetch" href="/notes/assets/js/53.9d5c6032.js"><link rel="prefetch" href="/notes/assets/js/54.279ef24c.js"><link rel="prefetch" href="/notes/assets/js/55.f263bef6.js"><link rel="prefetch" href="/notes/assets/js/56.e689e4b6.js"><link rel="prefetch" href="/notes/assets/js/6.04dbe20d.js"><link rel="prefetch" href="/notes/assets/js/7.64d3e5cf.js"><link rel="prefetch" href="/notes/assets/js/8.a6fbdd51.js"><link rel="prefetch" href="/notes/assets/js/9.0b25e1bc.js">
    <link rel="stylesheet" href="/notes/assets/css/0.styles.69480afa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes/" class="home-link router-link-active"><!----> <span class="site-name">Full-stack web development notes.</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/8483/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/8483/notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/notes/" class="sidebar-link">Introduction</a></li><li><a href="/notes/topics/algos.html" class="sidebar-link">Algos</a></li><li><a href="/notes/topics/bash.html" class="sidebar-link">Bash</a></li><li><a href="/notes/topics/dom.html" class="sidebar-link">Dom</a></li><li><a href="/notes/topics/express.html" class="sidebar-link">Express</a></li><li><a href="/notes/topics/mssql.html" class="active sidebar-link">Mssql</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/notes/topics/raspberrypi.html" class="sidebar-link">Raspberrypi</a></li><li><a href="/notes/topics/testing.html" class="sidebar-link">Testing</a></li><li><a href="/notes/topics/webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/notes/topics/ansible.html" class="sidebar-link">Ansible</a></li><li><a href="/notes/topics/caching.html" class="sidebar-link">Caching</a></li><li><a href="/notes/topics/electricity.html" class="sidebar-link">Electricity</a></li><li><a href="/notes/topics/filesystem.html" class="sidebar-link">Filesystem</a></li><li><a href="/notes/topics/mysql.html" class="sidebar-link">Mysql</a></li><li><a href="/notes/topics/react.html" class="sidebar-link">React</a></li><li><a href="/notes/topics/tmux.html" class="sidebar-link">Tmux</a></li><li><a href="/notes/topics/architecture.html" class="sidebar-link">Architecture</a></li><li><a href="/notes/topics/compression.html" class="sidebar-link">Compression</a></li><li><a href="/notes/topics/electronics.html" class="sidebar-link">Electronics</a></li><li><a href="/notes/topics/fp.html" class="sidebar-link">Fp</a></li><li><a href="/notes/topics/networking.html" class="sidebar-link">Networking</a></li><li><a href="/notes/topics/restful.html" class="sidebar-link">Restful</a></li><li><a href="/notes/topics/users.html" class="sidebar-link">Users</a></li><li><a href="/notes/topics/arduino.html" class="sidebar-link">Arduino</a></li><li><a href="/notes/topics/config.html" class="sidebar-link">Config</a></li><li><a href="/notes/topics/electron.html" class="sidebar-link">Electron</a></li><li><a href="/notes/topics/git.html" class="sidebar-link">Git</a></li><li><a href="/notes/topics/nginx.html" class="sidebar-link">Nginx</a></li><li><a href="/notes/topics/rfid.html" class="sidebar-link">Rfid</a></li><li><a href="/notes/topics/vagrant.html" class="sidebar-link">Vagrant</a></li><li><a href="/notes/topics/async.html" class="sidebar-link">Async</a></li><li><a href="/notes/topics/csharp.html" class="sidebar-link">Csharp</a></li><li><a href="/notes/topics/elm.html" class="sidebar-link">Elm</a></li><li><a href="/notes/topics/javascript.html" class="sidebar-link">Javascript</a></li><li><a href="/notes/topics/nodemcu.html" class="sidebar-link">Nodemcu</a></li><li><a href="/notes/topics/security.html" class="sidebar-link">Security</a></li><li><a href="/notes/topics/vim.html" class="sidebar-link">Vim</a></li><li><a href="/notes/topics/babel.html" class="sidebar-link">Babel</a></li><li><a href="/notes/topics/css.html" class="sidebar-link">Css</a></li><li><a href="/notes/topics/es6.html" class="sidebar-link">Es6</a></li><li><a href="/notes/topics/linux.html" class="sidebar-link">Linux</a></li><li><a href="/notes/topics/node.html" class="sidebar-link">Node</a></li><li><a href="/notes/topics/ssh.html" class="sidebar-link">Ssh</a></li><li><a href="/notes/topics/vm.html" class="sidebar-link">Vm</a></li><li><a href="/notes/topics/base.html" class="sidebar-link">Base</a></li><li><a href="/notes/topics/docker.html" class="sidebar-link">Docker</a></li><li><a href="/notes/topics/excel.html" class="sidebar-link">Excel</a></li><li><a href="/notes/topics/mobile.html" class="sidebar-link">Mobile</a></li><li><a href="/notes/topics/oop.html" class="sidebar-link">Oop</a></li><li><a href="/notes/topics/systemd.html" class="sidebar-link">Systemd</a></li><li><a href="/notes/topics/vscode.html" class="sidebar-link">Vscode</a></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="partition-by"><a href="#partition-by" aria-hidden="true" class="header-anchor">#</a> Partition By</h1> <p>We use this to make a &quot;sub-query&quot; i.e. select n-th item from a table for further use.</p> <h3 id="data"><a href="#data" aria-hidden="true" class="header-anchor">#</a> Data</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 
    clientID<span class="token punctuation">,</span>
    invoiceDate<span class="token punctuation">,</span>
    revenue
<span class="token keyword">FROM</span> sales
</code></pre></div><table><thead><tr><th>clientID</th> <th>invoiceDate</th> <th>revenue</th></tr></thead> <tbody><tr><td>1017</td> <td>2019-01-31</td> <td>6574.65</td></tr> <tr><td>116</td> <td>2018-02-05</td> <td>5593.22</td></tr> <tr><td>1211</td> <td>2018-01-15</td> <td>3637.80</td></tr> <tr><td>116</td> <td>2018-02-16</td> <td>1848.00</td></tr> <tr><td>1211</td> <td>2018-01-09</td> <td>15615.65</td></tr> <tr><td>1017</td> <td>2019-02-14</td> <td>1386.00</td></tr> <tr><td>1211</td> <td>2018-02-09</td> <td>16145.72</td></tr> <tr><td>116</td> <td>2018-02-13</td> <td>2784.51</td></tr> <tr><td>1211</td> <td>2018-03-28</td> <td>8844.64</td></tr></tbody></table> <h3 id="data-with-partition-by"><a href="#data-with-partition-by" aria-hidden="true" class="header-anchor">#</a> Data with PARTITION BY</h3> <p>In this case, we want to have the latest sale for each client. We can achieve this by partitioning the data i.e. ordering the sales for each client in descending order based on the date. We can then select only the desired row with <code>rowNumber</code>.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 
    ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> clientID <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> invoiceDate <span class="token keyword">DESC</span><span class="token punctuation">)</span> rowNumber<span class="token punctuation">,</span>
    clientID<span class="token punctuation">,</span>
    invoiceDate<span class="token punctuation">,</span>
    revenue
<span class="token keyword">FROM</span> sales
</code></pre></div><table><thead><tr><th>rowNumber</th> <th>clientID</th> <th>invoiceDate</th> <th>revenue</th></tr></thead> <tbody><tr><td>1</td> <td>1017</td> <td>2019-02-14</td> <td>1386.00</td></tr> <tr><td>2</td> <td>1017</td> <td>2019-01-31</td> <td>6574.65</td></tr> <tr><td>1</td> <td>116</td> <td>2018-02-16</td> <td>1848.00</td></tr> <tr><td>2</td> <td>116</td> <td>2018-02-13</td> <td>2784.51</td></tr> <tr><td>3</td> <td>116</td> <td>2018-02-05</td> <td>5593.22</td></tr> <tr><td>1</td> <td>1211</td> <td>2018-03-28</td> <td>8844.64</td></tr> <tr><td>2</td> <td>1211</td> <td>2018-02-09</td> <td>16145.72</td></tr> <tr><td>3</td> <td>1211</td> <td>2018-01-15</td> <td>3637.80</td></tr> <tr><td>4</td> <td>1211</td> <td>2018-01-09</td> <td>15615.65</td></tr></tbody></table> <h3 id="result"><a href="#result" aria-hidden="true" class="header-anchor">#</a> Result</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 
    lastSale<span class="token punctuation">.</span>clientID<span class="token punctuation">,</span> 
    lastSale<span class="token punctuation">.</span>invoiceDate<span class="token punctuation">,</span> 
    lastSale<span class="token punctuation">.</span>revenue
<span class="token keyword">FROM</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span> 
        ROW_NUMBER<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> clientID <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> invoiceDate <span class="token keyword">DESC</span><span class="token punctuation">)</span> rowNumber<span class="token punctuation">,</span>
        clientID<span class="token punctuation">,</span>
        invoiceDate<span class="token punctuation">,</span>
        revenue
    <span class="token keyword">FROM</span> sales
<span class="token punctuation">)</span> lastSale
<span class="token keyword">WHERE</span> lastSale<span class="token punctuation">.</span>rowNumber <span class="token operator">=</span> <span class="token number">1</span>
</code></pre></div><p>We only get the first row for each client i.e. the last sale (sorted by descending invoice date).</p> <table><thead><tr><th>acReceiver</th> <th>adDate</th> <th>sales</th></tr></thead> <tbody><tr><td>1017</td> <td>2019-02-14</td> <td>1386.00</td></tr> <tr><td>116</td> <td>2018-02-16</td> <td>1848.00</td></tr> <tr><td>1211</td> <td>2018-03-28</td> <td>8844.64</td></tr></tbody></table> <h1 id="pivot"><a href="#pivot" aria-hidden="true" class="header-anchor">#</a> Pivot</h1> <p>In order for the pivoting to work, we must <strong>only use the columns needed</strong>, instead of all of them. This results in repeating rows.</p> <h3 id="data-2"><a href="#data-2" aria-hidden="true" class="header-anchor">#</a> Data</h3> <p>Here is some example data, obtained by the given query.</p> <table><thead><tr><th>product</th> <th>yearSold</th> <th>revenue</th></tr></thead> <tbody><tr><td>shoes</td> <td>2018</td> <td>33924978.2497</td></tr> <tr><td>shirts</td> <td>2018</td> <td>34362105.196</td></tr> <tr><td>hats</td> <td>2018</td> <td>25119529.9395</td></tr> <tr><td>shoes</td> <td>2019</td> <td>6947797.012</td></tr> <tr><td>shirts</td> <td>2019</td> <td>8070039.2266</td></tr> <tr><td>hats</td> <td>2019</td> <td>5780623.5762</td></tr></tbody></table> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
    product<span class="token punctuation">,</span>
    yearSold<span class="token punctuation">,</span>
    revenue
<span class="token keyword">FROM</span> sales
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
    yearSold<span class="token punctuation">,</span>
    product
</code></pre></div><h3 id="approach-1-from"><a href="#approach-1-from" aria-hidden="true" class="header-anchor">#</a> Approach 1 (FROM)</h3> <p><img src="/notes/assets/img/pivot_unpivot.d93e83c0.png" alt="TEA"></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> 
    product<span class="token punctuation">,</span>  <span class="token comment">-- grouping column</span>
    <span class="token punctuation">[</span><span class="token number">2019</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">-- spreading value 1</span>
    <span class="token punctuation">[</span><span class="token number">2018</span><span class="token punctuation">]</span>    <span class="token comment">-- spreading value 2</span>
<span class="token keyword">FROM</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span>
        product<span class="token punctuation">,</span>      <span class="token comment">-- grouping column</span>
        yearSold<span class="token punctuation">,</span>     <span class="token comment">-- spreading column</span>
        revenue       <span class="token comment">-- aggregation column</span>
    <span class="token keyword">FROM</span> sales
    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
        yearSold<span class="token punctuation">,</span>
        product
<span class="token punctuation">)</span> PivotData
    <span class="token keyword">PIVOT</span> <span class="token punctuation">(</span> 
        <span class="token function">SUM</span><span class="token punctuation">(</span>revenue<span class="token punctuation">)</span>   <span class="token comment">-- aggregation function (aggregation column)</span>
        <span class="token keyword">FOR</span> yearSold   <span class="token comment">-- spreading column</span>
        <span class="token operator">IN</span> <span class="token punctuation">(</span>
            <span class="token punctuation">[</span><span class="token number">2019</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment">-- spreading value 1</span>
            <span class="token punctuation">[</span><span class="token number">2018</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">-- spreading value 2</span>
        <span class="token punctuation">)</span> piv
</code></pre></div><table><thead><tr><th>product</th> <th>2019</th> <th>2018</th></tr></thead> <tbody><tr><td>shoes</td> <td>694</td> <td>3392</td></tr> <tr><td>shirts</td> <td>807</td> <td>3436</td></tr> <tr><td>hats</td> <td>578</td> <td>2511</td></tr></tbody></table> <h3 id="approach-2-with"><a href="#approach-2-with" aria-hidden="true" class="header-anchor">#</a> Approach 2 (WITH)</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WITH</span> PivotData <span class="token keyword">AS</span> <span class="token punctuation">(</span>
    <span class="token keyword">SELECT</span>
        product<span class="token punctuation">,</span>
        yearSold<span class="token punctuation">,</span>
        revenue
    <span class="token keyword">FROM</span> sales
    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
        yearSold<span class="token punctuation">,</span>
        product
<span class="token punctuation">)</span> 
<span class="token keyword">SELECT</span> <span class="token punctuation">[</span><span class="token keyword">group</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2019</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2018</span><span class="token punctuation">]</span>
<span class="token keyword">FROM</span> PivotData
    <span class="token keyword">PIVOT</span> <span class="token punctuation">(</span> <span class="token function">SUM</span><span class="token punctuation">(</span>revenue<span class="token punctuation">)</span> <span class="token keyword">FOR</span> <span class="token punctuation">[</span><span class="token keyword">year</span><span class="token punctuation">]</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2019</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2018</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> piv
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/notes/topics/express.html" class="prev">
          Express
        </a></span> <span class="next"><a href="/notes/topics/raspberrypi.html">
          Raspberrypi
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/notes/assets/js/app.b2f0b337.js" defer></script><script src="/notes/assets/js/2.1225d179.js" defer></script><script src="/notes/assets/js/11.c1cf1b66.js" defer></script>
  </body>
</html>
